# Makefile to produce the article.
LATEX  =  TEXINPUTS=.//: BSTINPUTS=.//: latex
DVIPS  =  dvips
FIGURES = figures/Flux.HIFLUGCS.eps \
	figures/spectrum.NT.core.1Vs10mug.g72a.noGal2.2Rvp.p2-fit.eps \
	figures/spectrum.NT.whim.1Vs10mug.g72a.noGal2.2Rvp.p2-fit.eps \
	figures/flux.comp.new.g72a.Vs.g914.noGal2.eps \
	figures/HIFLUGCS.fermi.eps \
	figures/PS.CvsR.g72.c+sf.CR.z0.eps \
	figures/PS.CvsR.g914.c+sf.CR.z0.eps \
	figures/scaling_gamma_energy.zeta1.picZ-cut.noGal2.h70.eps \
	figures/scaling_gamma.zeta1.picZ-cut.100MeV.h70.3Rvir.eps \
	figures/scaling_gamma_GalVsNoGal.zeta1.picZ-cut.h70.eps \
	figures/fit.tildeC.eps \
	figures/alpha.g72a.c+sf.CR.5CRpop.z0.periphery.h70.p2-fit.picZ2-cut.0.1-1GeV.10muG.aB05.zeta1.noGal2.eps \
	figures/alpha.g72a.c+sf.CR.5CRpop.z0.periphery.h70.p2-fit.picZ2-cut.0.1-1TeV.10muG.aB05.zeta1.noGal2.eps \
	figures/F.noProj.pp.1d10.g72a.c+sf.CR.5CRpop.z0.noGal2.eps \
	figures/F.noProj.pp.radial.one.1d10.g72a.c+sf.CR.5CRpop.z0.pcut.2RVp.noGal2.eps \
	figures/F.noProj.all.c+sf.CR.5CRpop.z0.eps

.PRECIOUS: $(FIGURES)

default: paper.ps

%.ps :  $(FIGURES) %.tex
	$(LATEX) $*.tex
	TEXINPUTS=:.// BSTINPUTS=:.// bibtex $*
#	cat $*.bbl | sed 's/, \\&/, /' > tmp.bbl
#	mv tmp.bbl $*.bbl
	$(LATEX) $*.tex
	$(LATEX) $*.tex
	$(LATEX) $*.tex
	$(DVIPS) -o $*.ps $*.dvi
	ps2pdf $*.ps $*.pdf
	make clean

figures/%.eps: figures/%_raw.eps figures/%.tex
	(cd figures; latex $*.tex; \
	dvips -E -o $*.eps $*.dvi; \
	perl -ane '{ s/%%BoundingBox: [-0-9]+/%%BoundingBox: 135/g; print}' $*.eps > tmp.eps; \
	mv tmp.eps $*.eps; \
	rm -f *.dvi *.log *.aux)

clean:
	rm -f *.log *.toc *.aux *.dvi *.bak *.bbl *.blg *.obj *.out

realclean:
	rm -f *.log *.toc *.aux *.dvi *.obj *.bak *.bbl *.blg *.brf \
              *.ps */*.ps *~ */*~ *.bak */*.bak 








